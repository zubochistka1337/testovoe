# Human Detection Service

Этот проект представляет собой сервис обнаружения людей с использованием YOLOv8 и отправкой уведомлений через Server-Sent Events (SSE).

## Запуск

**Linux:**

```bash
docker-compose up --build
```

**Windows:**

```bash
pip install -r requirements.txt
```

*   Желательно наличие CUDA, cuDNN и совместимого PyTorch для ускорения обработки.
*   Запуск сервера:

```bash
uvicorn main:app --host localhost --port 5000
```

## Функциональность

*   **Управление камерой:**
    *   Endpoint'ы `/start` и `/stop` для включения/выключения камеры. Работа камеры организована в отдельном процессе или потоке.
    *   Для межпроцессного взаимодействия используется Redis.

*   **Файл настроек `settings.json`:**
    *   Файл настроек расположен в корне проекта и содержит координаты и размеры области кадра для поиска человека.
    *   Файл создается автоматически при первом запуске со стандартными настройками. Изменения вступают в силу после перезапуска приложения.

*   **Server-Sent Events (SSE) `/events`:**
    *   Endpoint для отправки событий добавления фотографии в базу данных.
    *   События рассылаются всем подписанным клиентам через Redis Pub/Sub. Сервером является процесс с рантаймом камеры, клиентом(ами) является само приложение, получающее запросы на event от `index.html`.

*   **Сохранение изображений:**
    *   При обнаружении человека в указанной области кадра в течение 5 секунд, изображение его "box" сохраняется в базу данных (SQLite). Таймер 5 секунд запускается заново после сохранения.

*   **Endpoint `/humans`:**
    *   Endpoint для получения списка ссылок на фотографии из базы данных.
    *   Поддерживается фильтрация по дате создания фото в указанном промежутке.

*   **Статическая страница:**
    *   Статическая страница в корне приложения (`localhost:5000/`) для отображения текущих фотографий, обновляемых через SSE.

*   **Автоматическая документация `/docs`:**
    *   Документация, сгенерированная автоматически.

## Реализация (Цитаты из ТЗ)

*   "Реализованы endpoint'ы для включения/выключения камеры (/start, /stop), камера должна работать в отельном процессе или потоке" - **OK** (Камера работает в отдельном потоке, управление через API)
*   "Для межпроцессного общения используется redis" - **OK**
*   "Реализовать файл настроек в виде файла settings.json в корне проекта, в нём необходимо хранить координаты и размеры области кадра, в которой будет происходить поиск человека" - **OK**
*   "Файл настроек создается сам при запуске со стандартными настройками, изменения вступят в силу при перезапуске приложения" - **OK**
*   "Server Side Event (/events) для отправки события добавления фотографии в базу данных" - **OK**
*   "События рассылаются всем подписанным клиентам через redis pub/sub. Сервером является процесс с рантаймом камеры, клиентом(ами) является по сути само приложение, на который приходит запрос на event от index.html" - **OK**
*   "В случае нахождения человека в указанной области кадра 5 секунд, сохранять изображение его «box» в базу данных (использовать SQLite), после чего таймер 5 секунд начинать заново" - **OK**
*   "Реализовать endpoint (/humans) с фильтром по дате создания фото, который будет возвращать список ссылок фотографий из базы данных в указанный промежуток дней" - **OK**
*   "Создать статическую страницу в корне приложения (localhost:5000/), которая будет реагировать на SSE от сервера и отображать текущие фотографии на странице" - **OK**
*   "Работает, если страничка открыта на локалхосте" - **ОК** (как и требовалось в задании)
*   "Проработать страницу с автоматической документацией (/docs)" - **OK** (Немного не понял, что там прорабатывать на 3 эндпоинта, тем более дока автоматическая)

## Что можно было бы добавить для реальной задачи

*   Логирование (особенно при работе с разными процессами).
*   Обработка ошибок.
*   Структурирование папок/проекта/импортов.
*   Оптимизация архитектуры и алгоритмов.

## Используемые ресурсы

*   Распознавание объектов на YOLOv8.
*   Веса взяты готовые отсюда, в основе модель скорее всего n (суперлегкая): [https://github.com/J3lly-Been/YOLOv8-HumanDetection](https://github.com/J3lly-Been/YOLOv8-HumanDetection)

## Тестирование

Протестировано на Windows без Docker.  Тестирование на Linux не проводилось из-за отсутствия доступа к оборудованию с Linux и проблем с драйверами камеры и пробросом USB в WSL.
